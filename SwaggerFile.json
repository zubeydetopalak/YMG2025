openapi: 3.0.0
info:
  title: SmartBill Restoran API
  description: Restoran adisyon, masa yönetimi ve sipariş takibi için geliştirilmiş REST API.
  version: 1.0.0
  contact:
    email: info@smartbill.com
    name: SmartBill Developer

servers:
  - url: http://localhost:5002
    description: Yerel Docker Sunucusu

tags:
  - name: Genel
    description: Genel sistem durumu
  - name: Masalar
    description: Masa yönetimi ve durum sorgulama
  - name: Sipariş & Ödeme
    description: Sipariş girişi ve hesap işlemleri

paths:
  /:
    get:
      tags:
        - Genel
      summary: API Sağlık Kontrolü
      description: API'nin çalışıp çalışmadığını kontrol eder.
      responses:
        '200':
          description: Başarılı
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "SmartBill API Çalışıyor"
                  status:
                    type: string
                    example: "active"

  /masalar:
    get:
      tags:
        - Masalar
      summary: Tüm Masaları Listele
      description: Masaların doluluk oranlarını, toplam borçlarını ve kalan bakiyelerini listeler.
      responses:
        '200':
          description: Başarılı
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MasaDurum'
    post:
      tags:
        - Masalar
      summary: Yeni Masa Oluştur
      description: Sisteme yeni bir masa tanımlar.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MasaEkle'
      responses:
        '201':
          description: Masa başarıyla oluşturuldu
        '400':
          description: Hatalı istek veya masa ID zaten mevcut

  /masalar/{masa_id}/sifirla:
    delete:
      tags:
        - Masalar
      summary: Masayı Sıfırla (Hesap Kapat)
      description: Müşteri kalktığında masanın siparişlerini siler ve bakiyesini sıfırlar.
      parameters:
        - name: masa_id
          in: path
          description: Sıfırlanacak masanın ID'si
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Başarılı sıfırlama işlemi
        '404':
          description: Masa bulunamadı

  /siparis:
    post:
      tags:
        - Sipariş & Ödeme
      summary: Sipariş Ekle
      description: Belirli bir masaya ürün ve tutar ekler.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SiparisEkle'
      responses:
        '201':
          description: Sipariş eklendi
        '404':
          description: Masa bulunamadı

  /odeme:
    post:
      tags:
        - Sipariş & Ödeme
      summary: Ödeme Yap
      description: Masadan kısmi veya tam ödeme alır.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OdemeYap'
      responses:
        '200':
          description: Ödeme başarılı, kalan bakiye dönülür.
        '400':
          description: Hatalı istek

components:
  schemas:
    MasaEkle:
      type: object
      required:
        - id
        - masa_adi
      properties:
        id:
          type: string
          description: Masanın benzersiz kodu
          example: "masa_5"
        masa_adi:
          type: string
          description: Masanın görünen adı
          example: "Bahçe Masa 5"

    MasaDurum:
      type: object
      properties:
        id:
          type: string
        ad:
          type: string
        toplam_siparis_tutari:
          type: number
          format: float
          example: 450.0
        odenen_tutar:
          type: number
          format: float
          example: 100.0
        kalan_bakiye:
          type: number
          format: float
          example: 350.0
        durum:
          type: string
          enum: [Müsait, Dolu]
          example: "Dolu"

    SiparisEkle:
      type: object
      required:
        - masa_id
        - urun_adi
        - tutar
      properties:
        masa_id:
          type: string
          example: "masa_5"
        urun_adi:
          type: string
          example: "Künefe"
        tutar:
          type: number
          format: float
          example: 120.0

    OdemeYap:
      type: object
      required:
        - masa_id
        - tutar
      properties:
        masa_id:
          type: string
          example: "masa_5"
        tutar:
          type: number
          format: float
          description: Ödenen miktar
          example: 50.0
